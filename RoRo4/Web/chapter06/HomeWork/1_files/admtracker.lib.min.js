((e,t)=>{const adm=e.adm=e.adm||{},query=new URLSearchParams((t.currentScript||[...t.getElementsByTagName("script")].pop()).src.split("?")[1]||""),n=query.get("json_id");let o,i;n?(o=`https://ps.l.liftdsp.com/${encodeURIComponent(n)}.json`,i=Array.isArray(window.custom_data)?window.custom_data:[{}]):(o=window.adm&&window.adm.json||void 0,i=Array.isArray(window.admCustomData)?window.admCustomData:[{}]);const a=Object.assign({t:"https://pool.liftdsp.com",o:"https://segment.prod.bidr.io",i:"https://cnv.event.prod.bidr.io",l:"https://track.liftdsp.com/collect",u:"https://track.liftdsp.com/diagnostic",p:"true"===query.get("diagnostics")}),r=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),s=(()=>{const e="pixelsink_uid",t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2];const n=r();return document.cookie=`${e}=${n}; path=/; max-age=31536000`,n})();function c(){const e=navigator.userAgent;return/Windows NT/.test(e)?"Windows":/Mac OS X/.test(e)?"macOS":/Linux/.test(e)?"Linux":/Android/.test(e)?"Android":/iPhone|iPad|iPod/.test(e)?"iOS":"Unknown"}function l(e){let t=0;for(let n=0;e.length>n;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return""+t}async function d(){const e=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,Intl.DateTimeFormat().resolvedOptions().timeZone],[t,n]=await Promise.all([new Promise(e=>{setTimeout(()=>{const t=document.createElement("canvas");t.style.display="none",t.width=300,t.height=150,document.body.appendChild(t);const n=t.getContext("2d");n.textBaseline="top",n.font="16px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText("Browser FP Test",2,15),t.toBlob(n=>{const o=new FileReader;o.onloadend=()=>{document.body.removeChild(t),e(l(o.result))},o.readAsBinaryString(n)},"image/png")},300*Math.random()+200)}),new Promise(e=>{try{const t=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,44100,44100),n=t.createOscillator(),o=t.createDynamicsCompressor();n.type="triangle",n.frequency.setValueAtTime(1e4,t.currentTime),o.threshold.setValueAtTime(-50,t.currentTime),o.knee.setValueAtTime(40,t.currentTime),o.ratio.setValueAtTime(12,t.currentTime),o.attack.setValueAtTime(0,t.currentTime),o.release.setValueAtTime(.25,t.currentTime),n.connect(o),o.connect(t.destination),n.start(0),t.startRendering().then(t=>{let n=0;const o=t.getChannelData(0);for(let e=0;o.length>e;e++)n+=Math.abs(o[e]);e(l(""+n))})}catch(t){e("unsupported")}})]),o=function(){const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return{vendor:"unsupported",_:"unsupported"};const n=t.getExtension("WEBGL_debug_renderer_info");return{vendor:n?t.getParameter(n.UNMASKED_VENDOR_WEBGL):"unknown",_:n?t.getParameter(n.UNMASKED_RENDERER_WEBGL):"unknown"}}(),i=[...e,navigator.platform,screen.colorDepth,navigator.hardwareConcurrency,navigator.deviceMemory||0,(navigator.plugins||[]).length,t,n,o.vendor,o._];return{fingerprint_ortb:btoa(e.join("|")),fingerprint_highres:btoa(i.join("|"))}}const u=(e,t={},n="query")=>{const o=[];for(const n in t)if(!e||!e.custom_data||e.custom_data.includes(n)){const e=Array.isArray(t[n])?t[n].join("+"):t[n];o.push(`${encodeURIComponent(n)}=${encodeURIComponent(e)}`)}return o.join("inline"===n?";":"&")},p=e=>{(new Image).src=e},_=async({m:e,custom_data:t,timestamp:n,pixel_fire_id:o,pixel_fire_group_id:i})=>{const[r,l]=await Promise.all([d(),new Promise(e=>function(e){const t={tcf_string:null,gdpr_applies:null,us_privacy_string:null};let n=0;"function"==typeof __tcfapi&&(n++,__tcfapi("getTCData",2,(o,i)=>{i&&o&&(t.tcf_string=o.v||null,t.gdpr_applies=o.$??null),0===--n&&e(t)})),"function"==typeof __uspapi&&(n++,__uspapi("getUSPData",1,(o,i)=>{i&&o&&(t.us_privacy_string=o.h||null),0===--n&&e(t)})),0===n&&e(t),setTimeout(()=>{n>0&&e(t)},500)}(e))]),u={i_segment_id:e?.id,b_segment_id:e.bid,b_event_id:e.eid,lift_user_id:s,pixel_fire_id:o,pixel_fire_group_id:i,custom_data:t||t[0],trigger_rule:e.rules||null,fingerprint_ortb:r.fingerprint_ortb,fingerprint_highres:r.fingerprint_highres,url:location.href,device:{user_agent:navigator.userAgent,language:navigator.language,platform:navigator.userAgentData?.platform||navigator.platform,screen:`${screen.width}x${screen.height}`,device_type:/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop",os:c()},tcf_string:l.tcf_string,gdpr_applies:l.gdpr_applies,us_privacy_string:l.us_privacy_string,timestamp:n||(new Date).toISOString()},_=btoa(JSON.stringify(u));p(`${a.l}?data=${_}`)},m=(e,n,o,i)=>{e.length&&(e=>{if([...t.getElementsByTagName("script")].some(t=>t.src===e))return;const n=t.createElement("script");n.src=e,n.async=!0,t.head.appendChild(n)})(`${a.t}/pixel?id=${e.join(",")}&t=js&sink_id=${s}&${n}&timestamp=${o}&fire_id=${i}`)},g=(e,t,n)=>{e.forEach(e=>{e&&p(`${a.o}/associate-segment?account_id=2&buzz_key=moot&value=${n}&segment_key=moot-${e}&ord=${t}`)})},f=(e,t,n,o)=>{const i=u(null,t,"inline");Object.entries(e).forEach(([e,t])=>{t&&p(`${a.i}/log/cnv?tag_id=${t}&buzz_key=moot&value=${o}&account_id=2&order=${i}&ord=${n}&segment_key=moot-${e}`)})},w=({k:e,P:t,D:n,S:o,reason:i})=>{if(!a.p)return;const r={type:"diagnostic",timestamp:(new Date).toISOString(),lift_user_id:s,A:t,D:n,url:location.href,I:e?.type,O:JSON.stringify(e?.values||[]),result:"passed"===o||"delayed"===o,R:"failed"===o?i:"passed",metadata:e||{}};navigator.sendBeacon(a.u,JSON.stringify(r))},v=async e=>{const t=[],n=[],o={},a=i[0]||{},s=u(null,a),c=(new Date).toISOString(),l=`${Date.now()}-${r()}`;if(e&&e.length)for(const i of e){const e=`${Date.now()}-${r()}`;t.push(i.id),n.push(i.bid),i.eid&&(o[i.bid]=i.eid),await _({m:i,custom_data:a,timestamp:c,pixel_fire_id:e,pixel_fire_group_id:l}),m([i.id],s,c,e),g([i.bid],c,e),f({[i.bid]:i.eid},a,c,e)}},$=()=>{o&&fetch(o).then(e=>e.json()).then(t=>{const n=location.href,o=[];t.pixels.forEach(t=>{((t,n,o=1)=>!(!t.rules||!Array.isArray(t.rules))&&t.rules.every(i=>{const a=i.values;let r=!1,s="";switch(i.type){case"url_contains":r=a.some(e=>n.includes(e)),s=r?"match":"no match";break;case"url_does_not_contain":r=a.every(e=>!n.includes(e)),s=r?"clean":"blocked";break;case"url_match":r=a.some(e=>RegExp(`^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}$`,"i").test(n)),s=r?"regex match":"no match";break;case"url_does_not_match":r=a.every(e=>!RegExp(`^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}$`,"i").test(n)),s=r?"clean":"regex blocked";break;case"frequency":if(a?.operator&&void 0!==a.value){const e={U:e=>e>a.value,F:e=>a.value>e,T:e=>e===a.value};r=e[a.operator]?.(o),s=`${a.operator} ${a.value}`}break;case"anniversary":r=(new Date).getMonth()===parseInt(a),s="month="+(new Date).getMonth();break;case"custom_data":const c=((e.adm=e.adm||{}).custom_data?.[0]||{})[a.key];if(void 0!==c){const e=a.operator,t=a.value;r={T:(e,t)=>e==t,U:(e,t)=>parseFloat(e)>parseFloat(t),F:(e,t)=>parseFloat(t)>parseFloat(e),j:(e,t)=>e!=t,contains:(e,t)=>(e+"").includes(t)}[e]?.(c,t)??!1,s=r?"custom match":"custom fail"}else s="custom key missing";break;case"recency":const l=`liftpx_${t.id}_ts`,d=localStorage.getItem(l),u=Date.now(),p=864e5*parseInt(a.q);d?(r=u-parseInt(d)>=p,s=r?"recency ok":"too soon",r&&localStorage.setItem(l,""+u)):(localStorage.setItem(l,""+u),r=!0,s="first fire");break;case"time_spent":const _=parseInt(a)||10;return setTimeout(()=>{v([t]),w({I:i.type,P:t.id,S:"delayed",reason:_+"s"})},1e3*_),!1;default:s="unsupported"}return w({k:i,P:t.id,D:t.eid||null,S:r?"pass":"fail",reason:s}),r}))(t,n)&&o.push(t)}),t.id&&!o.some(e=>e.id===t.id)&&o.push({id:t.id,bid:t.bid}),v(o)}).then(e=>{}).catch(e=>{})};"complete"===t.readyState||"interactive"===t.readyState?$():t.addEventListener("DOMContentLoaded",$),adm.track=({id:e,bid:t,eid:n})=>v([{id:e,bid:t,eid:n}])})(window,document);
//# sourceMappingURL=smartpixel.min.js.map